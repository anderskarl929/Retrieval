<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fr√•gegenerator - AI Agent</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #856404;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #555;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group textarea {
            min-height: 200px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group small {
            color: #666;
            font-size: 0.9em;
            display: block;
            margin-top: 5px;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .results h2 {
            color: #28a745;
            margin-bottom: 20px;
        }

        .question-preview {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .question-preview .q-text {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .question-preview .option {
            padding: 8px 15px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .question-preview .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .api-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .api-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .api-option:hover {
            border-color: #667eea;
        }

        .api-option.selected {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .api-option h3 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .api-option p {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ AI Fr√•gegenerator</h1>
        <p class="subtitle">Generera automatiskt 1X2-fr√•gor fr√•n text med AI</p>

        <div class="warning-box">
            <strong>‚ö†Ô∏è API-nyckel kr√§vs:</strong> F√∂r att anv√§nda denna agent beh√∂ver du en API-nyckel fr√•n antingen Anthropic (Claude) eller OpenAI (GPT). Du kan f√• en gratis provnyckel fr√•n deras webbplatser.
        </div>

        <div class="section">
            <h2>V√§lj AI-motor</h2>
            <div class="api-selector">
                <div class="api-option selected" onclick="selectAPI('anthropic')">
                    <h3>Anthropic Claude</h3>
                    <p>Rekommenderas - Snabb och noggrann</p>
                </div>
                <div class="api-option" onclick="selectAPI('openai')">
                    <h3>OpenAI GPT</h3>
                    <p>Alternativ - Ocks√• mycket bra</p>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="form-group">
                <label for="apiKey">API-nyckel:</label>
                <input type="text" id="apiKey" placeholder="sk-ant-... eller sk-...">
                <small id="apiKeyHelp">F√• din nyckel fr√•n <a href="https://console.anthropic.com/" target="_blank">Anthropic Console</a></small>
            </div>

            <div class="form-group">
                <label for="subject">√Ñmne:</label>
                <select id="subject">
                    <option value="Historia">Historia</option>
                    <option value="Geografi">Geografi</option>
                    <option value="Biologi">Biologi</option>
                    <option value="Fysik">Fysik</option>
                    <option value="Kemi">Kemi</option>
                    <option value="Matematik">Matematik</option>
                    <option value="Svenska">Svenska</option>
                    <option value="Engelska">Engelska</option>
                    <option value="Samh√§llskunskap">Samh√§llskunskap</option>
                </select>
            </div>

            <div class="form-group">
                <label for="numQuestions">Antal fr√•gor:</label>
                <input type="number" id="numQuestions" value="5" min="1" max="20">
                <small>Rekommenderat: 5-10 fr√•gor per textavsnitt</small>
            </div>

            <div class="form-group">
                <label for="inputText">Text att skapa fr√•gor fr√•n:</label>
                <textarea id="inputText" placeholder="Klistra in texten h√§r...

Exempel:
Sverige blev medlem i Europeiska unionen den 1 januari 1995, efter en folkomr√∂stning 1994 d√§r 52,3% r√∂stade ja. Tillsammans med Sverige gick √§ven Finland och √ñsterrike med i EU samma dag. Detta kallas f√∂r den fj√§rde utvidgningen av EU."></textarea>
                <small>Ju mer text, desto b√§ttre fr√•gor kan genereras</small>
            </div>

            <button class="btn" onclick="generateQuestions()">üöÄ Generera Fr√•gor</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Genererar fr√•gor med AI... Detta kan ta 10-30 sekunder.</p>
        </div>

        <div class="results" id="results">
            <h2>‚úì Fr√•gor Genererade!</h2>
            <div id="questionsPreview"></div>

            <div class="button-group">
                <button class="btn btn-success" onclick="downloadCSV()">üì• Ladda ner CSV</button>
                <button class="btn" onclick="copyToClipboard()">üìã Kopiera CSV</button>
                <button class="btn" onclick="resetForm()">üîÑ Skapa Fler Fr√•gor</button>
            </div>
        </div>
    </div>

    <script>
        let selectedAPI = 'anthropic';
        let generatedQuestions = [];
        let csvContent = '';

        function selectAPI(api) {
            selectedAPI = api;
            document.querySelectorAll('.api-option').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.closest('.api-option').classList.add('selected');

            // Update help text
            const helpText = document.getElementById('apiKeyHelp');
            if (api === 'anthropic') {
                helpText.innerHTML = 'F√• din nyckel fr√•n <a href="https://console.anthropic.com/" target="_blank">Anthropic Console</a>';
            } else {
                helpText.innerHTML = 'F√• din nyckel fr√•n <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a>';
            }
        }

        async function generateQuestions() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const subject = document.getElementById('subject').value;
            const numQuestions = parseInt(document.getElementById('numQuestions').value);
            const inputText = document.getElementById('inputText').value.trim();

            // Validation
            if (!apiKey) {
                alert('V√§nligen ange din API-nyckel');
                return;
            }

            if (!inputText) {
                alert('V√§nligen ange text att skapa fr√•gor fr√•n');
                return;
            }

            if (inputText.length < 50) {
                alert('Texten √§r f√∂r kort. Ange minst 50 tecken f√∂r b√§sta resultat.');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            try {
                if (selectedAPI === 'anthropic') {
                    await generateWithAnthropic(apiKey, subject, numQuestions, inputText);
                } else {
                    await generateWithOpenAI(apiKey, subject, numQuestions, inputText);
                }

                // Show results
                displayResults();
            } catch (error) {
                alert('Fel vid generering av fr√•gor: ' + error.message);
                console.error(error);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function generateWithAnthropic(apiKey, subject, numQuestions, text) {
            const prompt = createPrompt(text, numQuestions, subject);

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKey,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-5-sonnet-20241022',
                    max_tokens: 4000,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'API-anrop misslyckades');
            }

            const data = await response.json();
            const responseText = data.content[0].text;

            parseQuestionsResponse(responseText);
        }

        async function generateWithOpenAI(apiKey, subject, numQuestions, text) {
            const prompt = createPrompt(text, numQuestions, subject);

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: 'Du √§r en expert p√• att skapa pedagogiska √∂vningsfr√•gor.'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'API-anrop misslyckades');
            }

            const data = await response.json();
            const responseText = data.choices[0].message.content;

            parseQuestionsResponse(responseText);
        }

        function createPrompt(text, numQuestions, subject) {
            return `Du √§r en expert p√• att skapa pedagogiska √∂vningsfr√•gor f√∂r ${subject}.

Din uppgift √§r att skapa ${numQuestions} st 1X2-fr√•gor (flervalsfr√•gorfr√•gor) fr√•n f√∂ljande text.

VIKTIGA REGLER:
1. Skapa fr√•gor som testar faktakunskap och f√∂rst√•else
2. Varje fr√•ga ska ha EXAKT 3 svarsalternativ
3. Endast ETT alternativ √§r r√§tt
4. De tv√• felaktiga alternativen (distraktorer) ska vara trov√§rdiga men tydligt felaktiga
5. Fr√•gorna ska vara p√• svenska
6. Svara ENDAST med JSON-format (inget annat text)

TEXT:
${text}

Svara med f√∂ljande JSON-format:
{
  "questions": [
    {
      "question": "Fr√•getexten h√§r?",
      "option1": "F√∂rsta alternativet",
      "option2": "Andra alternativet",
      "option3": "Tredje alternativet",
      "correct": 1
    }
  ]
}

D√§r "correct" √§r 1, 2 eller 3 (vilket alternativ som √§r r√§tt).

Generera ${numQuestions} fr√•gor nu:`;
        }

        function parseQuestionsResponse(responseText) {
            // Find JSON in response
            const start = responseText.indexOf('{');
            const end = responseText.lastIndexOf('}') + 1;

            if (start === -1 || end === 0) {
                throw new Error('Kunde inte hitta JSON i AI-svaret');
            }

            const jsonStr = responseText.substring(start, end);
            const data = JSON.parse(jsonStr);

            generatedQuestions = data.questions || [];

            if (generatedQuestions.length === 0) {
                throw new Error('Inga fr√•gor genererades');
            }

            // Convert to CSV
            csvContent = questionsToCSV(generatedQuestions);
        }

        function questionsToCSV(questions) {
            const lines = [];

            for (const q of questions) {
                const question = (q.question || '').trim().replace(/,/g, ';');
                const option1 = (q.option1 || '').trim().replace(/,/g, ';');
                const option2 = (q.option2 || '').trim().replace(/,/g, ';');
                const option3 = (q.option3 || '').trim().replace(/,/g, ';');
                const correct = q.correct || 1;

                lines.push(`"${question}","${option1}","${option2}","${option3}",${correct}`);
            }

            return lines.join('\n');
        }

        function displayResults() {
            const preview = document.getElementById('questionsPreview');
            preview.innerHTML = '';

            generatedQuestions.forEach((q, index) => {
                const div = document.createElement('div');
                div.className = 'question-preview';

                const questionText = document.createElement('div');
                questionText.className = 'q-text';
                questionText.textContent = `${index + 1}. ${q.question}`;
                div.appendChild(questionText);

                [1, 2, 3].forEach(i => {
                    const option = document.createElement('div');
                    option.className = 'option';
                    if (i === q.correct) {
                        option.classList.add('correct');
                    }
                    option.textContent = `${i}. ${q[`option${i}`]}`;
                    div.appendChild(option);
                });

                preview.appendChild(div);
            });

            document.getElementById('results').style.display = 'block';
        }

        function downloadCSV() {
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            const subject = document.getElementById('subject').value;
            const timestamp = new Date().toISOString().slice(0, 10);

            link.setAttribute('href', url);
            link.setAttribute('download', `fragor_${subject}_${timestamp}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(csvContent).then(() => {
                alert('CSV-inneh√•ll kopierat till urklipp!');
            }).catch(err => {
                alert('Kunde inte kopiera till urklipp: ' + err);
            });
        }

        function resetForm() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('inputText').value = '';
            generatedQuestions = [];
            csvContent = '';
        }
    </script>
</body>
</html>
